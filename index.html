<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZenChain NFT Gallery</title>
<style>
  :root{--bg:#0f0f12;--card:#141416;--accent:#7c4dff;--muted:#9aa0a6}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff}
  header{padding:20px;text-align:center;background:#0c0c0e}
  .controls{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  input,button{padding:10px;border-radius:10px;border:none}
  input{background:#0b0b0d;color:#fff;border:1px solid rgba(255,255,255,0.1)}
  button{background:var(--accent);color:#fff;cursor:pointer}
  .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;padding:18px}
  .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 6px 20px rgba(0,0,0,0.5)}
  .thumb{width:100%;height:200px;object-fit:cover}
  .info{padding:12px}
  .name{font-weight:600}
  .meta{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <h2>ZenChain NFT Gallery (Testnet)</h2>
  <div class="controls">
    <input id="addr" placeholder="Wallet Address" />
    <button id="btn">Scan All</button>
  </div>
</header>
<main>
  <div id="gallery" class="gallery"></div>
</main>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>
<script>
const RPC = 'https://zenchain-testnet.api.onfinality.io/public';
const provider = new ethers.JsonRpcProvider(RPC);

// Daftar kontrak NFT populer di ZenChain Testnet
const NFT_CONTRACTS = [
  "0x5a9525389B2c53c56BC3a2e4Fcdb4DC88326550d", // Sample Zentrace NFT
  // tambahkan kontrak NFT lain di sini
];

const ERC721_ABI = [
  'function balanceOf(address owner) view returns (uint256)',
  'function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)',
  'function tokenURI(uint256 tokenId) view returns (string)'
];

const gallery = document.getElementById('gallery');
document.getElementById('btn').onclick = async () => {
  gallery.innerHTML = '';
  const owner = document.getElementById('addr').value.trim();
  if (!ethers.isAddress(owner)) return alert('Alamat wallet tidak valid');
  
  for (const contractAddr of NFT_CONTRACTS) {
    try {
      const contract = new ethers.Contract(contractAddr, ERC721_ABI, provider);
      const balance = await contract.balanceOf(owner);
      const n = Number(balance.toString());
      if (n === 0) continue;

      for (let i = 0; i < n; i++) {
        loadNFT(contract, contractAddr, owner, i);
      }
    } catch (e) {
      console.error("Error kontrak:", contractAddr, e);
    }
  }
};

async function loadNFT(contract, contractAddr, owner, index) {
  try {
    const tokenId = await contract.tokenOfOwnerByIndex(owner, index);
    let uri = await contract.tokenURI(tokenId);
    if (uri.startsWith('ipfs://')) {
      uri = uri.replace('ipfs://', 'https://ipfs.io/ipfs/');
    }
    let meta;
    try {
      const res = await fetch(uri);
      meta = await res.json();
    } catch {
      meta = { name: 'NFT #' + tokenId, image: '' };
    }
    let img = meta?.image || '';
    if (img.startsWith('ipfs://')) {
      img = img.replace('ipfs://', 'https://ipfs.io/ipfs/');
    }
    if (!img) {
      img = 'https://via.placeholder.com/400x400?text=No+Image';
    }
    renderCard(img, meta?.name || ('Token #' + tokenId), tokenId, contractAddr);
  } catch (err) {
    console.error("NFT load error:", err);
  }
}

function renderCard(img, name, tokenId, contractAddr) {
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <img class="thumb" src="${img}" alt="${name}">
    <div class="info">
      <div class="name">${name}</div>
      <div class="meta">ID: ${tokenId} <br>Contract: ${contractAddr}</div>
    </div>`;
  gallery.appendChild(card);
}
</script>
</body>
</html>
